
@{
	ViewBag.Title = "Agenda";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Agenda</h2>
<div id="calender"></div>

<!--llamo a las librerias (sin internet no sirve)-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.print.css" rel="stylesheet" media="print" />

@section Scripts{

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.js"></script>
	<script src='fullcalendar/lang/es.js'></script>

	<script>
		$(document).ready(function () {
			var events = [];

			$.ajax({
				type: 'GET',
				url: '/Reserva/GetEvents',
				success: function (data) {
					$.each(data, function (i, v) {
						events.push({
							title: v.Subject,
							idreserva: v.IdReserva,
							start: moment(v.FechaInicio),
							end: v.FechaFin != null ? moment(v.FechaFin) : null,
							color: v.Color,
							allDay: v.IsFullDay
						});
					})

					GenerateCalender(events);
				},
				error: function (error) {
					alert('fallido');
				}
			})

			function GenerateCalender(events) {
				var date = @Html.Raw(Json.Encode(ViewData["fecha"]));
				$('#calender').fullCalendar('destroy');

				$('#calender').fullCalendar({

					monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
					monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
					dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
					dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
					contentHeight: 400,
					allDaySlot: false,
					minTime: "08:00:00",
					maxTime: "17:00:00",
					height: 'auto',
					defaultView: 'agendaDay',
					defaultDate: new Date(date),
					timeFormat: 'h(:mm)a',
					businessHours: {
						// days of week. an array of zero-based day of week integers (0=Sunday)
						dow: [1, 2, 3, 4, 5], // Monday - Thursday

						start: '08:00', // a start time (10am in this example)
						end: '17:00', // an end time (6pm in this example)
					},
					header: {
						left: 'prev,next',
						center: 'title',
						right: ''
					},
					eventLimit: true,
					eventColor: '#BD94E5',
					events: events,
					eventClick: function (event) {
						if (event.title) {
							window.location.href = '/Reserva/Delete?idreserva=' + event.idreserva;
						}
					},
					dayClick: function (date, jsEvent, view) {


						window.location.href = '/Reserva/Create?fecha=' + date.toString();
					},
					selectable: true,
					selectHelper: true,

				});


			}

		})
	</script>
}


